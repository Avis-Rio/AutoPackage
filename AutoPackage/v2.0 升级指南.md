# v2.0 升级指南

## 🎉 重大升级：真正的合并单元格支持

### 主要变化

#### 1. 文件格式升级
- **旧版本**: `.xls` (Excel 97-2003)
- **新版本**: `.xlsx` (Excel 2007+) ⭐

#### 2. 核心库更换
- **旧版本**: xlwt + xlutils (功能受限)
- **新版本**: openpyxl (现代化，功能完整) ⭐

#### 3. 新增功能
- ✅ **真正的合并单元格** - 不再是模拟，而是原生Excel合并
- ✅ **完美的样式复制** - 使用openpyxl的copy()功能
- ✅ **更小的文件** - xlsx是压缩格式，文件更小
- ✅ **更好的兼容性** - 支持所有现代Excel版本

---

## 升级步骤

### 如果您是首次使用
无需任何操作，直接使用即可！

### 如果您已经在使用旧版本

#### 步骤1: 更新依赖
```bash
# Windows
cd AutoPackage
python -m pip install -r requirements.txt

# macOS/Linux
python3 -m pip install -r requirements.txt
```

#### 步骤2: 使用新模板
- 旧模板: `template.xls`
- **新模板**: `template.xlsx` ⭐
- 程序已自动配置使用新模板

#### 步骤3: 输出文件格式
- 旧格式: `输出.xls`
- **新格式**: `输出.xlsx` ⭐
- 程序会自动使用新格式

#### 步骤4: 运行测试
```bash
python3 test_conversion.py
```

应该看到：
```
✓ 成功生成文件: test_output.xlsx
✓ 文件大小: 99,799 bytes
```

---

## 功能对比

| 功能 | v1.x (xlwt) | v2.0 (openpyxl) |
|------|-------------|-----------------|
| 文件格式 | .xls | .xlsx ⭐ |
| 合并单元格 | ❌ 模拟（多个单元格） | ✅ 真正合并 |
| 样式复制 | ⚠️ 部分支持 | ✅ 完全支持 |
| 文件大小 | ~110KB | ~100KB (更小) |
| Excel兼容性 | Excel 97-2003 | Excel 2007+ |
| 开发活跃度 | ❌ 已停止维护 | ✅ 积极维护 |

---

## 合并单元格效果对比

### v1.x (旧版)
```
+----------------+
| A1 | B1 | C1  |  <- 看起来像合并，实际是3个单元格
+----------------+
```

### v2.0 (新版)
```
+----------------+
|      A1:C1     |  <- 真正的Excel合并单元格 ⭐
+----------------+
```

打开Excel文件，选中单元格，状态栏会显示 "A1:D1"！

---

## 常见问题

### Q: 旧的.xls文件还能转换吗？
**A**: 能！程序仍然支持读取.xls格式的配分表，只是输出改为.xlsx格式。

### Q: 需要重新安装吗？
**A**: 只需运行 `pip install -r requirements.txt` 更新依赖即可。

### Q: 旧的.xls模板还能用吗？
**A**: 不推荐。请使用新的template.xlsx。如果您有自定义的.xls模板，可以用`convert_template.py`转换。

### Q: 如何转换自定义模板？
**A**: 
```bash
python3 convert_template.py
# 或者修改脚本中的文件名
```

### Q: 文件大小为什么变小了？
**A**: .xlsx是基于XML的压缩格式，比.xls的二进制格式更高效。

---

## 技术细节

### openpyxl的优势

1. **现代化API**
   ```python
   # 合并单元格
   sheet.merge_cells('A1:D1')
   
   # 样式复制
   target_cell.font = copy(template_cell.font)
   ```

2. **更好的样式支持**
   - 渐变填充
   - 条件格式
   - 数据验证
   - 图表支持

3. **活跃维护**
   - 定期更新
   - bug修复及时
   - 社区支持好

---

## 迁移检查清单

- [ ] 安装新依赖: `pip install -r requirements.txt`
- [ ] 使用新模板: `template.xlsx`
- [ ] 运行测试: `python3 test_conversion.py`
- [ ] 检查输出文件打开正常
- [ ] 确认合并单元格显示正确
- [ ] 验证样式保留完整

---

**升级完成！享受真正的合并单元格吧！** 🎉
